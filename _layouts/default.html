<!doctype html>
<html lang="en">
    <head>
        {% include template/head.html %}  
    </head>
    <body>
        {% include template/header.html %}

        <div id="mydiv" style="border: solid 1px #111; position: absolute; ">
                <span id="draghandel" style="border:solid red 1px; width:100%;height:50px;background-color: rgb(205, 237, 140);">header</span>

                <div> 
                        {% for setting in site.data.settings %}
                        <div class="inputcolorcontainer">
                            <label for="{{setting.key}}">{{setting.key}}</label>
                            <input  type="color" id="{{setting.key}}" oninput="changeColor('{{setting.key}}')">
                        </div>  
                        {% endfor %}

                        <div class="inputcolorcontainer">
                          <label for="usefooter">use footer</label>
                          <input type="checkbox" name="usefooter" id="usefooter">
                        </div>  
                        <div class="inputcolorcontainer">
                          <label for="usecollapsiblemenu">use collapsible menu</label>
                          <input type="checkbox" name="usecollapsiblemenu" id="usecollapsiblemenu">
                        </div>  
                </div>
        </div>


        <main id="maincontent" role="main" aria-label="Content">
            {{ content }}
        </main>

        {% if site.nofooter!=true %}
            {% if page.nofooter!=true %}
                {% include template/footer.html %} 
            {% endif %}
        {% endif %}

        {% include template/foot.html %}



        <script>          
            function changeColor(thisid) { 
                console.log(thisid);
                const userColor = document.getElementById(thisid).value;
                document.documentElement.style.setProperty("--" + thisid, userColor);
                localStorage.setItem(thisid, userColor);
            }

            function changeColorOld(thisid,cssvarname) { 
                const userColor = document.getElementById(thisid).value;
                document.documentElement.style.setProperty(cssvarname, userColor);
                localStorage.setItem(thisid, userColor);
            }

          
            function initColor(thisid){
                if(localStorage[thisid]) {
                    const _localStoreValue=localStorage[thisid];
                    document.documentElement.style.setProperty("--" + thisid, _localStoreValue);
                    document.getElementById(thisid).value = _localStoreValue;  
                }            
            else {                    
                    const _colorfromcss=getComputedStyle(document.documentElement).getPropertyValue("--" + thisid);                    
                    localStorage.setItem(thisid, _colorfromcss.trim());
                    document.getElementById(thisid).value = _colorfromcss.trim();  
                } 
            }
            {% for setting in site.data.settings %}
                initColor("{{setting.key}}");  
            {% endfor %}



        </script>


        <script>
                      function setposition(){
                        //set initial position
                        //if(!(localStorage["posleft"] && localStorage["postop"])) ;

                        dragItem.style.left=localStorage["posleft"]; 
                        dragItem.style.top=localStorage["postop"];  

                        //awoid moving outside the screen
                        if(dragItem.getBoundingClientRect().x +dragItem.clientWidth>window.innerWidth-20){      
                          let _posleft=window.innerWidth-dragItem.clientWidth-20;
                          dragItem.style.left=_posleft + "px";
                          localStorage.setItem("posleft", _posleft + "px");
                        }
                        if(dragItem.getBoundingClientRect().top +dragItem.clientHeight>window.innerHeight-20){
                            let _postop=window.innerHeight-dragItem.clientHeight-20;
                            dragItem.style.top=_postop + "px";
                            localStorage.setItem("postop", _postop + "px");
                        }
                        if(dragItem.getBoundingClientRect().x<0){
                          dragItem.style.left=5 + "px";
                        }
                        if(dragItem.getBoundingClientRect().top<0){
                          dragItem.style.top=5 + "px";
                        }  

                    }
        </script>
        <script>
            

            
            var dragItem = document.querySelector("#mydiv");
            var dragItemHandel = document.querySelector("#draghandel");           
            var container = document.querySelector("body");

            var active = false;
            var currentX;
            var currentY;
            var initialX;
            var initialY;
            var xOffset = 0;
            var yOffset = 0;


            //eventlisteners s√¶ttes til body
            container.addEventListener("touchstart", dragStart, false);
            container.addEventListener("touchend", dragEnd, false);
            container.addEventListener("touchmove", drag, false);

            container.addEventListener("mousedown", dragStart, false);
            container.addEventListener("mouseup", dragEnd, false);
            container.addEventListener("mousemove", drag, false);


            setposition();



            function dragStart(e) {
              
              if (e.type === "touchstart") {
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
              } else {
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
              }
              if (e.target === dragItemHandel) {
                active = true;
              }
/*               if (e.target === dragItem) {
                active = true;
              } */
            }

            function dragEnd(e) {
              initialX = currentX;
              initialY = currentY;
              localStorage.setItem("posleft",(dragItem.getBoundingClientRect().left) + "px");
              localStorage.setItem("postop", (dragItem.getBoundingClientRect().top) + "px");
              active = false;
            }

            function drag(e) {
              if (active) {
              
                e.preventDefault();
              
                if (e.type === "touchmove") {
                  currentX = e.touches[0].clientX - initialX;
                  currentY = e.touches[0].clientY - initialY;
                } else {
                  currentX = e.clientX - initialX;
                  currentY = e.clientY - initialY;
                }

                xOffset = currentX;
                yOffset = currentY;

                setTranslate(currentX, currentY, dragItem);
              }
            }

            function setTranslate(xPos, yPos, el) {
              el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
            }








          </script>



    </body>
</html>